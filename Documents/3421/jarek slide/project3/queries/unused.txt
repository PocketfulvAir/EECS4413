select dx.cid, dx.name from (select distinct dx.cid, dx.name, dx.ttl, dy.cnt from (select purchase.cid, customer.name, count(distinct club) as ttl from purchase inner join customer on customer.cid = purchase.cid group by purchase.cid, customer.name) as dx inner join (select cid, count(Club) as cnt from member group by cid) as dy on dy.cid = dx.cid group by dx.cid, dx.name, dx.ttl, dy.cnt) as dx Where dx.ttl < dx.cnt group by dx.cid, dx.name